(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"./src/typescript/dependency injection.mdx":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return s});var r=n("./node_modules/_@babel_runtime@7.4.3@@babel/runtime/helpers/esm/objectWithoutProperties.js"),c=(n("./node_modules/_react@16.8.6@react/index.js"),n("./node_modules/_@mdx-js_react@1.0.6@@mdx-js/react/dist/index.es.js")),a={},o="wrapper";function s(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(c.b)(o,Object.assign({},a,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)("h1",{id:"typescript\u4f9d\u8d56\u6ce8\u5165"},"Typescript\u4f9d\u8d56\u6ce8\u5165"),Object(c.b)("h2",{id:"background"},"Background"),Object(c.b)("p",null,"\u4e4b\u524d\u770b\u5230\u4e00\u4e2a\u5e93typedi\u5b9e\u73b0\u4e86DI\u65b9\u6848\uff0c\u89c9\u5f97\u6bd4\u8f83\u70ab\u9177\uff0c\u4e8e\u662f\u6253\u7b97\u81ea\u5df1\u5199\u4e00\u4e2amini\u7248\u7684\u4f9d\u8d56\u6ce8\u5165\u3002"),Object(c.b)("h2",{id:"theory"},"Theory"),Object(c.b)("p",null,"\u4f9d\u8d56\u6ce8\u5165\u7684\u57fa\u672c\u539f\u7406\u662f\u5229\u7528\u4e00\u4e9b\u624b\u6bb5\uff08\u5982\u9759\u6001\u5206\u6790\u65b9\u6cd5\uff09\u6765\u6807\u8bb0\u9700\u8981\u6ce8\u5165\u7684\u5bf9\u8c61\u7684\u7b26\u53f7\uff0c\u540c\u65f6\u63d0\u4f9b\u6807\u8bb0\u65b9\u6cd5\uff08\u901a\u5e38\u662f\u6ce8\u89e3\uff0cjs\u9886\u57df\u4e0a\u5219\u662fdecorator\uff09\u6765\u5728\u5168\u5c40\u6536\u96c6\u53ef\u4ee5\u88ab\u6ce8\u5165\u5230\u5176\u4ed6\u5bf9\u8c61\u4e0a\u7684\u5b9e\u4f8b\u5bf9\u5e94\u7684\u7c7b\u3002\u6240\u4ee5\u8981\u70b9\u53ea\u67093\u4e2a\uff1a",Object(c.b)("br",{parentName:"p"}),"\n","1. \u5168\u5c40\u67e5\u627e\u548c\u6ce8\u518c\u7684\u670d\u52a1\n2. \u4f7f\u7528\u88c5\u9970\u5668\u8fdb\u884c\u6ce8\u518c\u548c\u6ce8\u5165\uff0cts(\u548cjs)\u73b0\u5df2\u539f\u751f\u652f\u6301\n3. \u5bf9\u6ce8\u5165\u8fdb\u884c\u5206\u6790\u548c\u81ea\u52a8\u67e5\u627e\u5e76\u6ce8\u5165"),Object(c.b)("h2",{id:"problem"},"Problem"),Object(c.b)("p",null,"\u56f0\u96be\u4e3b\u8981\u5728\u4e8e\u5982\u4f55\u83b7\u53d6\u6ce8\u5165\u5bf9\u8c61\u7684\u7c7b\u578b\u3002\u7531\u4e8eTypescript\u5728\u7f16\u8bd1\u4e3ajs\u540e\u662f\u4e0d\u4fdd\u7559\u7c7b\u578b\u4fe1\u606f\u7684\uff0c\u6240\u4ee5\u5fc5\u987b\u901a\u8fc7\u4e00\u4e9b\u652f\u6301\u65b9\u6cd5\u6765\u8ba9\u88c5\u9970\u5668\u77e5\u9053\u6ce8\u5165\u7684\u7c7b\u578b\u4fe1\u606f\u3002\u4e8b\u5b9e\u4e0a\uff0cts\u5bf9\u6b64\u4e5f\u6709\u539f\u751f\u7684\u652f\u6301\u65b9\u5f0f\u3002"),Object(c.b)("h2",{id:"solution"},"Solution"),Object(c.b)("p",null,'\u5728tsconfig\u7684"compilerOptions"\u4e2d\u8bbe\u7f6e"experimentalDecorators": true\uff0c"emitDecoratorMetadata": true, \u5728\u5168\u5c40\u73af\u5883\u4e0b\u9996\u5148\u5f15\u5165reflect-metadata\u5e93\u5bf9Reflect API\u4f5c\u6269\u5c55\u3002'),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"import 'reflect-metadata'\n")),Object(c.b)("p",null,"\u5bf9\u5e94\u7684\u670d\u52a1\u6ce8\u518c\u548c\u67e5\u627e\u7684\u7b80\u5355\u5b9e\u73b0\u5982\u4e0b"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),'const store = new Map<any, any>();\n\nconst Registry = {\n  naming: <T extends new () => any>(constructor: T) => {\n    store.set(constructor, new constructor())\n  },\n  lookup: <T extends new () => any>(constructor: T) => {\n    return store.get(constructor) as InstanceType<T>\n  },\n  inject: <T>(target: T, propertyKey: string | symbol) => {\n    const key = Reflect.getMetadata("design:type", target, propertyKey);\n    (target as any)[propertyKey] = store.get(key)\n  }\n}\nexport default Registry\n')),Object(c.b)("p",null,"\u5176\u4e2dnaming\u88c5\u9970\u5668\u7528\u6237\u5728\u6620\u5c04\u8868\u4e2d\u6ce8\u5165\u7c7b\uff0cinject\u5219\u67e5\u627e\u5e76\u8fdb\u884c\u6ce8\u5165\u3002\u53ef\u4ee5\u6ce8\u610f\u4e00\u4e0b\u5176\u4e2d\u7684Reflect.getMetadata\u65b9\u6cd5\uff0c\u8fd9\u662f\u7531reflect-metadata\u6269\u5c55\u5b9e\u73b0\u7684\uff0c\u9700\u8981\u548cTypescript\u7684\u7f16\u8bd1\u76f8\u7ed3\u5408\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),'import Registry from "../utils/Registry"\nimport ModelService from "./ModelService"\n@Registry.naming\nclass LanguageService {\n\n  @Registry.inject\n  private modelService!: ModelService\n  constructor() {\n  }\n}\n\nexport default LanguageService\n')),Object(c.b)("p",null,"\u8fd9\u662f\u4e00\u4e2a\u6ce8\u518c\u548c\u6ce8\u5165\u7684\u4f8b\u5b50\uff0c\u76f8\u5173\u7684\u65b9\u6cd5\u5728Registry\u4e2d\u6ce8\u518c\u4e86LanguageService\u7684\u5b9e\u4f8b\uff0c\u5e76\u81ea\u52a8\u6ce8\u5165ModelService\u7684\u5b9e\u4f8b\u3002"),Object(c.b)("h2",{id:"in-the-deep"},"In the deep"),Object(c.b)("p",null,"\u5177\u4f53\u7684\u539f\u7406\uff0c\u53ef\u4ee5\u67e5\u770bTypescript\u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u6765\u7406\u89e3"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),'"use strict";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);\n};\nObject.defineProperty(exports, "__esModule", { value: true });\nconst Registry_1 = require("../utils/Registry");\nconst ModelService_1 = require("./ModelService");\nlet LanguageService = class LanguageService {\n    constructor() {\n    }\n};\n__decorate([\n    Registry_1.default.inject,\n    __metadata("design:type", ModelService_1.default)\n], LanguageService.prototype, "modelService", void 0);\nLanguageService = __decorate([\n    Registry_1.default.naming,\n    __metadata("design:paramtypes", [])\n], LanguageService);\nexports.default = LanguageService;\n')),Object(c.b)("p",null,"\u5f88\u5bb9\u6613\u7406\u89e3\u7684\u662f\uff0c\u5728\u5f00\u542f\u8bb0\u5f55meta\u7684\u60c5\u51b5\u4e0b\uff0cTypescript\u5728\u7f16\u8bd1\u65f6\u989d\u5916\u6ce8\u5165\u6765\u7c7b\u578b\u4fe1\u606f\u4ee5\u4f9b\u88c5\u9970\u5668\u4f7f\u7528\u3002\u5177\u4f53\u53ef\u4ee5\u67e5\u9605(reflect-metadata)","[https://github.com/rbuckton/reflect-metadata]"))}s&&s===Object(s)&&Object.isExtensible(s)&&Object.defineProperty(s,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MDXContent",filename:"src/typescript/dependency injection.mdx"}}),s.isMDXComponent=!0}}]);
//# sourceMappingURL=src-typescript-dependency-injection.d578da47077014e722d2.js.map