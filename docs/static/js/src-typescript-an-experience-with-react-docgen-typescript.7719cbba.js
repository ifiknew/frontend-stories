(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"./src/typescript/an experience with react-docgen-typescript.mdx":function(e,r,t){"use strict";t.r(r),t.d(r,"default",function(){return s});var n=t("./node_modules/_@babel_runtime@7.4.3@@babel/runtime/helpers/esm/objectWithoutProperties.js"),o=(t("./node_modules/_react@16.8.6@react/index.js"),t("./node_modules/_@mdx-js_react@1.0.6@@mdx-js/react/dist/index.es.js")),a={},p="wrapper";function s(e){var r=e.components,t=Object(n.a)(e,["components"]);return Object(o.b)(p,Object.assign({},a,t,{components:r,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"\u8bb0\u5f55\u4e00\u6b21react-docgen-typescript\u7ecf\u5386"},"\u8bb0\u5f55\u4e00\u6b21react-docgen-typescript\u7ecf\u5386"),Object(o.b)("h2",{id:"background"},"Background"),Object(o.b)("p",null,"\u4e4b\u524d\u6709\u4e00\u4e2aidea\u662f\u505a\u4e00\u4e2a\u7ec4\u4ef6\u53ef\u89c6\u5316\u7f16\u8f91\u5668\uff0c\u53ef\u4ee5\u901a\u8fc7dnd\u7684\u65b9\u5f0f\u6765\u7f16\u8f91\u7ec4\u4ef6\u548c\u751f\u6210\u4ee3\u7801\u3002\u5176\u4e2d\u7684\u8bbe\u60f3\u5305\u62ec\u4f7f\u7528react-docgen-typescript\u6765\u6293\u53d6\u7ec4\u4ef6\u7684propTypes\uff0c\u751f\u6210\u7ec4\u4ef6props\u7684\u53ef\u89c6\u5316\u7f16\u8f91\u9762\u677f\u3002\u9047\u5230\u7684\u95ee\u9898\u662f\u5bf9\u7c7b\u7ec4\u4ef6\u4f7f\u7528\u5982\u4e0b\u7684\u65b9\u5f0f"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"const path = require('path')\nconsole.log(\n  require('react-docgen-typescript')\n  .parse(\n    path.join(__dirname, 'Test.tsx'),\n  )\n)\n")),Object(o.b)("p",null,"\u6253\u5370\u51fa\u7684\u5185\u5bb9\u4e3a\u7a7a\u6570\u7ec4\uff0c\u800c\u51fd\u6570\u7ec4\u4ef6\u6b63\u5e38\u3002"),Object(o.b)("h2",{id:"understanding-parsewithprogramprovider"},"Understanding parseWithProgramProvider"),Object(o.b)("p",null,"\u8c03\u8bd5\u7684\u8fc7\u7a0b\u662f\u4f7f\u7528vscode\u914d\u7f6edebug\u5de5\u5177\uff0c\u628a\u65ad\u70b9\u6253\u5728.parse\u65b9\u6cd5\u4e0a\u3002  "),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"/**\n * Parses a file with default TS options\n * @param filePath component file that should be parsed\n */\nfunction parse(filePathOrPaths, parserOpts) {\n    if (parserOpts === void 0) { parserOpts = exports.defaultParserOpts; }\n    return withCompilerOptions(defaultOptions, parserOpts).parse(filePathOrPaths);\n}\n")),Object(o.b)("p",null,"parse\u65b9\u6cd5\u7684\u5185\u5bb9\u662f\u68c0\u67e5\u662f\u5426\u5b58\u5728\u9ed8\u8ba4\u7684parserOpts\uff0c\u7136\u540e\u8c03\u7528withCompilerOptions\u65b9\u6cd5\u8fd4\u56de\u7684\u5bf9\u8c61\u7684parse\u65b9\u6cd5\u3002  "),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"/**\n * Constructs a parser for a specified set of TS compiler options.\n */\nfunction withCompilerOptions(compilerOptions, parserOpts) {\n    if (parserOpts === void 0) { parserOpts = exports.defaultParserOpts; }\n    return {\n        parse: function (filePathOrPaths) {\n            return parseWithProgramProvider(filePathOrPaths, compilerOptions, parserOpts);\n        },\n        parseWithProgramProvider: function (filePathOrPaths, programProvider) {\n            return parseWithProgramProvider(filePathOrPaths, compilerOptions, parserOpts, programProvider);\n        }\n    };\n}\n")),Object(o.b)("p",null,"\u76f4\u5230\u8fd9\u91cc\u8fd8\u6ca1\u6709\u5230\u4ee3\u7801\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u903b\u8f91\u57fa\u672c\u4e0a\u90fd\u5728\u5904\u7406\u9ed8\u8ba4\u53c2\u6570\u95ee\u9898\uff0c\u76f4\u5230\u8c03\u7528parseWithProgramProvider"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"function parseWithProgramProvider(filePathOrPaths, compilerOptions, parserOpts, programProvider) {\n    var filePaths = Array.isArray(filePathOrPaths)\n        ? filePathOrPaths\n        : [filePathOrPaths];\n    var program = programProvider\n        ? programProvider()\n        : ts.createProgram(filePaths, compilerOptions);\n    var parser = new Parser(program, parserOpts);\n    var checker = program.getTypeChecker();\n    return filePaths\n        .map(function (filePath) { return program.getSourceFile(filePath); })\n        .filter(function (sourceFile) {\n        return typeof sourceFile !== 'undefined';\n    })\n        .reduce(function (docs, sourceFile) {\n        var moduleSymbol = checker.getSymbolAtLocation(sourceFile);\n        if (!moduleSymbol) {\n            return docs;\n        }\n        Array.prototype.push.apply(docs, checker\n            .getExportsOfModule(moduleSymbol)\n            .map(function (exp) {\n            return parser.getComponentInfo(exp, sourceFile, parserOpts.componentNameResolver);\n        })\n            .filter(function (comp) { return comp !== null; })\n            .filter(function (comp, index, comps) {\n            return comps\n                .slice(index + 1)\n                .every(function (innerComp) { return innerComp.displayName !== comp.displayName; });\n        }));\n        return docs;\n    }, []);\n}\n")),Object(o.b)("p",null,"\u6838\u5fc3\u4ee3\u7801\u5206\u4e3a\u51e0\u4e2a\u90e8\u5206"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"\u9884\u5904\u7406\uff1a\u683c\u5f0f\u5316filePaths\u4e3aArray"),Object(o.b)("li",{parentName:"ul"},"\u5b9e\u4f8b\u5316\uff1aprogram\u3001parser\u548cchecker\u9700\u8981\u83b7\u53d6\u5230\u5b9e\u4f8b\u3002program\u548cchecker\u662fTypescript API\u4e2d\u7684\u6982\u5ff5\uff0c\u7a0d\u540e\u5bf9Typescript API\u8fdb\u884c\u8bf4\u660e\u3002parser\u662freact-docgen-typescript\u4e2d\u76f4\u63a5\u64cd\u4f5cTypescript API\u7684\u7c7b\u3002\u5176\u4e2d\u5b9a\u4e49\u4e86\u5f88\u591a\u4f7f\u7528Typescript API\u6765\u6293\u53d6.tsx?\u6587\u4ef6\u7ed3\u6784\u548c\u5185\u5bb9\u7684\u65b9\u6cd5\uff0c\u540c\u6837\u7a0d\u540e\u8fdb\u884c\u8bf4\u660e\u3002"),Object(o.b)("li",{parentName:"ul"},"\u8fd4\u56de\u503c\u5904\u7406\uff1a\u5c06\u6240\u6709\u7684\u8f93\u5165\u6587\u4ef6\u8def\u5f84\uff0c\u7ecf\u8fc7\u5982\u4e0b\u6b65\u9aa4\u7684\u7ba1\u9053\uff1a1.\u6839\u636e\u6587\u4ef6\u8def\u5f84\u83b7\u53d6\u6587\u4ef6\u4fe1\u606f\uff1b2.\u8fc7\u6ee4\u627e\u4e0d\u5230\u6587\u4ef6\u4fe1\u606f\u7684\u9879\u76ee\uff1b3.\u5bf9\u6bcf\u4e00\u4e2a\u6587\u4ef6\uff0c\u5bfb\u627e\u5176\u6a21\u5757\u5bfc\u51fa\u7684\u5185\u5bb9\uff0c\u8f6c\u5316\u4e3a\u7ec4\u4ef6\u4fe1\u606f\uff0c\u8fc7\u6ee4\u7a7a\u6570\u636e\u540e\u52a0\u5165\u5230\u8fd4\u56de\u7684\u961f\u5217\u4e2d\u3002")),Object(o.b)("h2",{id:"typescript-api"},"Typescript API"),Object(o.b)("p",null,"\u5728\u4e86\u89e3react-docgen-typescript\u7684\u89e3\u6790\u903b\u8f91\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5bf9Typescript API\u76f8\u5173\u7684\u5185\u5bb9\u8fdb\u884c\u4ecb\u7ecd\u3002"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"    /**\n     * Create a new 'Program' instance. A Program is an immutable collection of 'SourceFile's and a 'CompilerOptions'\n     * that represent a compilation unit.\n     *\n     * Creating a program proceeds from a set of root files, expanding the set of inputs by following imports and\n     * triple-slash-reference-path directives transitively. '@types' and triple-slash-reference-types are also pulled in.\n     *\n     * @param rootNames - A set of root files.\n     * @param options - The compiler options which should be used.\n     * @param host - The host interacts with the underlying file system.\n     * @param oldProgram - Reuses an old program structure.\n     * @param configFileParsingDiagnostics - error during config file parsing\n     * @returns A 'Program' object.\n     */\n    function createProgram(rootNames: ReadonlyArray<string>, options: CompilerOptions, host?: CompilerHost, oldProgram?: Program, configFileParsingDiagnostics?: ReadonlyArray<Diagnostic>): Program;\n    /** @deprecated */ interface ResolveProjectReferencePathHost {\n        fileExists(fileName: string): boolean;\n    }\n")),Object(o.b)("p",null,"createProgram\u9759\u6001\u65b9\u6cd5\u521b\u5efa\u4e86\u4e00\u4e2a\u201cProgram\u201d\u5bf9\u8c61\uff0c\u4ee3\u8868\u4e86\u4e00\u4e2a\u7f16\u8bd1\u5355\u5143\uff08\u4e00\u4e2a\u7f16\u8bd1\u5355\u5143\u5305\u62ec\u9700\u8981\u8f6c\u6362\u7684\u6587\u4ef6\u961f\u5217\u548c\u7f16\u8bd1\u9009\u9879\uff09\u3002"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"    /**\n     * Gets a type checker that can be used to semantically analyze source files in the program.\n     */\n    getTypeChecker(): TypeChecker;\n")),Object(o.b)("p",null,"Program\u7684getTypeChecker\u6210\u5458\u65b9\u6cd5\u53ef\u4ee5\u83b7\u53d6\u4e00\u4e2aTypeChecker\uff0c\u5b83\u7528\u6765\u5206\u6790\u6e90\u6587\u4ef6\u7684\u8bed\u4e49\u3002"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"    /**\n     * Get the source file in the program with file name\n     */\n    getSourceFile(fileName: string): SourceFile | undefined;\n")),Object(o.b)("p",null,"Program\u7684getSourceFile\u6210\u5458\u65b9\u6cd5\u7528\u4ee5\u6839\u636e\u6587\u4ef6\u8def\u5f84\u83b7\u53d6\u5230SourceFile\uff08\u6e90\u6587\u4ef6\u4fe1\u606f\uff09\u3002SourceFile\u4e0a\u6709\u4e00\u4e9b\u9488\u5bf9\u6e90\u6587\u4ef6\u4ee3\u7801\u884c\u3001\u5b57\u7b26\u4e0e\u4f4d\u7f6e\u7684\u4e92\u76f8\u8f6c\u6362\u7684\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7update\u65b9\u6cd5\u66f4\u65b0\u6e90\u6587\u4ef6\u3002"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"  getSymbolAtLocation(node: Node): Symbol | undefined;\n")),Object(o.b)("p",null,"Checker\u7684getSymbolAtLocation\u6210\u5458\u65b9\u6cd5\u53ef\u4ee5\u83b7\u5f97\u8282\u70b9\u7684\u63cf\u8ff0\u7b26\uff08\u53ef\u4ee5\u8fd9\u4e48\u7ffb\u8bd1\u5417\uff09,\u4f5c\u4e3a\u4e00\u4e2aesm\u6a21\u5757\u8fd4\u56de\u7684\u5185\u5bb9\u5305\u62ec{ exports: Map, declarations: ","[SourceFileObject]"," }\u7b49\u7b49\uff0c\u8be5\u63cf\u8ff0\u7b26\u7684flags\u4e3a512\uff08SymbolFlags.ValueModule\uff09\u3002"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"  getExportsOfModule(moduleSymbol: Symbol): Symbol[];\n")),Object(o.b)("p",null,"Checker\u7684getExportsOfModule\u6210\u5458\u65b9\u6cd5\u7528\u6765\u76f4\u63a5\u62ff\u5230\u6a21\u5757\u7684\u5bfc\u51fa\uff08Array\u5f62\u5f0f\uff09\uff0c\u4e00\u4e2a\u57fa\u7840\u7684tsx\u7ec4\u4ef6\uff0c\u5305\u62ec\u5bfc\u5165react\u3001\u5bfc\u51faprops\u63a5\u53e3\u5b9a\u4e49\u3001\u9ed8\u8ba4\u5bfc\u51fa\u7c7b\u5b9a\u4e49\uff0c\u8c03\u7528getExportsOfModule\u5219\u4f1a\u62ff\u52302\u4e2a\u6a21\u5757\u7684\u5bfc\u51fa\uff0c\u7b2c\u4e00\u4e2a\u7684flags\u4e3a64\uff08SymbolFlags.Interface\uff09\uff0c\u7b2c\u4e8c\u4e2a\u4e3a32\uff08SymbolFlags.Class\uff09\u3002\nParser\u7684\u6210\u5458\u65b9\u6cd5parseWithProgramProvider\u4e2d\u4f9d\u8d56\u7684Typescript API\u5747\u5df2\u4ecb\u7ecd\u5b8c\u6bd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u8c03\u7528\u4e86\u81ea\u8eab\u5b9e\u4f8b\u7684getComponentInfo\u65b9\u6cd5\u8fd8\u4f9d\u8d56\u4ee5\u4e0b\u4e00\u4e9bTypescript API\u3002"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"  getTypeOfSymbolAtLocation(symbol: Symbol, node: Node): Type;\n")),Object(o.b)("p",null,"Checker\u7684getTypeOfSymbolAtLocation\u6210\u5458\u65b9\u6cd5\u7528\u6765\u83b7\u53d6\u63cf\u8ff0\u7b26\u7684\u7c7b\u578b\u5b9a\u4e49\u3002"),Object(o.b)("h2",{id:"understanding-getcomponentinfo"},"Understanding getComponentInfo"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"    Parser.prototype.getComponentInfo = function (exp, source, componentNameResolver) {\n        if (componentNameResolver === void 0) { componentNameResolver = function () { return undefined; }; }\n        if (!!exp.declarations && exp.declarations.length === 0) {\n            return null;\n        }\n        var type = this.checker.getTypeOfSymbolAtLocation(exp, exp.valueDeclaration || exp.declarations[0]);\n        var commentSource = exp;\n        if (!exp.valueDeclaration) {\n            if (!type.symbol) {\n                return null;\n            }\n            exp = type.symbol;\n            var expName = exp.getName();\n            if (expName === 'StatelessComponent' ||\n                expName === 'Stateless' ||\n                expName === 'StyledComponentClass' ||\n                expName === 'FunctionComponent') {\n                commentSource = this.checker.getAliasedSymbol(commentSource);\n            }\n            else {\n                commentSource = exp;\n            }\n        }\n        // Skip over PropTypes that are exported\n        if (type.symbol &&\n            (type.symbol.getEscapedName() === 'Requireable' ||\n                type.symbol.getEscapedName() === 'Validator')) {\n            return null;\n        }\n        var propsType = this.extractPropsFromTypeIfStatelessComponent(type) ||\n            this.extractPropsFromTypeIfStatefulComponent(type);\n        var resolvedComponentName = componentNameResolver(exp, source);\n        var displayName = resolvedComponentName || computeComponentName(exp, source);\n        var description = this.findDocComment(commentSource).fullComment;\n        var methods = this.getMethodsInfo(type);\n        if (propsType) {\n            var defaultProps = this.extractDefaultPropsFromComponent(exp, source);\n            var props = this.getPropsInfo(propsType, defaultProps);\n            for (var _i = 0, _a = Object.keys(props); _i < _a.length; _i++) {\n                var propName = _a[_i];\n                var prop = props[propName];\n                var component = { name: displayName };\n                if (!this.propFilter(prop, component)) {\n                    delete props[propName];\n                }\n            }\n            return {\n                description: description,\n                displayName: displayName,\n                methods: methods,\n                props: props\n            };\n        }\n        else if (description && displayName) {\n            return {\n                description: description,\n                displayName: displayName,\n                methods: methods,\n                props: {}\n            };\n        }\n        return null;\n    };\n")),Object(o.b)("p",null,"Parser\u7684getComponentInfo\u6210\u5458\u65b9\u6cd5\u6709\u5173\u4e8eprops\u7684\u90e8\u5206\u662f\uff1a\u5148\u6839\u636eparseWithProgramProvider\u4e2d\u62ff\u5230\u7684\u5bfc\u51fa\u6a21\u5757\u4f7f\u7528checker\u4e2d\u7684getTypeOfSymbolAtLocation\u65b9\u6cd5\u62ff\u5230\u7c7b\u578b\u5b9a\u4e49\uff0c\u7136\u540e\u8c03\u7528\u81ea\u8eab\u7684extractPropsFromTypeIfStatelessComponent\u65b9\u6cd5\uff0c\u5982\u679c\u662f\u51fd\u6570\u7ec4\u4ef6\u5219\u53ef\u4ee5\u62ff\u5230props\u4fe1\u606f\uff0c\u5982\u679c\u8fd4\u56de\u4e3a\u7a7a\u5219\u5c1d\u8bd5\u4f7f\u7528extractPropsFromTypeIfStatefulComponent\u65b9\u6cd5\uff0c\u4ece\u7c7b\u7ec4\u4ef6\u4e2d\u62ff\u5230\u5bf9\u5e94\u7684props\u4fe1\u606f\u3002\u6700\u540e\u8c03\u7528\u81ea\u8eab\u7684getPropsInfo\u65b9\u6cd5\u4ecepropsType\u4e2d\u63d0\u53d6\u5230\u7c7b\u578b\u5b9a\u4e49\u3002"),Object(o.b)("h2",{id:"understanding-extractpropsfromtypeifstatelesscomponent"},"Understanding extractPropsFromTypeIfStatelessComponent"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"    Parser.prototype.extractPropsFromTypeIfStatelessComponent = function (type) {\n        var callSignatures = type.getCallSignatures();\n        if (callSignatures.length) {\n            // Could be a stateless component.  Is a function, so the props object we're interested\n            // in is the (only) parameter.\n            for (var _i = 0, callSignatures_1 = callSignatures; _i < callSignatures_1.length; _i++) {\n                var sig = callSignatures_1[_i];\n                var params = sig.getParameters();\n                if (params.length === 0) {\n                    continue;\n                }\n                // Maybe we could check return type instead,\n                // but not sure if Element, ReactElement<T> are all possible values\n                var propsParam = params[0];\n                if (propsParam.name === 'props' || params.length === 1) {\n                    return propsParam;\n                }\n            }\n        }\n        return null;\n    };\n")),Object(o.b)("p",null,"\u51fd\u6570\u7ec4\u4ef6\u90fd\u662f(props: IProps) => React.ReactNode\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u53ea\u8981\u62ff\u5230\u51fd\u6570\u7c7b\u578b\u7684\u8c03\u7528\u7b7e\u540d\u7684\u5165\u53c2\u7b2c\u4e00\u9879\u5c31\u53ef\u4ee5\u4e86\u3002"),Object(o.b)("h2",{id:"understanding-extractpropsfromtypeifstatefulcomponent"},"Understanding extractPropsFromTypeIfStatefulComponent"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"    Parser.prototype.extractPropsFromTypeIfStatefulComponent = function (type) {\n        var constructSignatures = type.getConstructSignatures();\n        if (constructSignatures.length) {\n            // React.Component. Is a class, so the props object we're interested\n            // in is the type of 'props' property of the object constructed by the class.\n            for (var _i = 0, constructSignatures_1 = constructSignatures; _i < constructSignatures_1.length; _i++) {\n                var sig = constructSignatures_1[_i];\n                var instanceType = sig.getReturnType();\n                var props = instanceType.getProperty('props');\n                if (props) {\n                    return props;\n                }\n            }\n        }\n        return null;\n    };\n")),Object(o.b)("p",null,"\u5982\u679c\u662f\u7c7b\u7ec4\u4ef6\uff0creact-docgen-typescript\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5148\u83b7\u53d6\u7c7b\u7684\u7c7b\u578b\u7684\u6784\u9020\u5668\u7b7e\u540d\uff0c\u7136\u540e\u62ff\u5230\u5b83\u7684\u8fd4\u56de\u503c\u7c7b\u578b\u4e2d\u7684props\u5b9a\u4e49\u3002"),Object(o.b)("h2",{id:"todo"},"todo"),Object(o.b)("p",null,"\u8fd8\u6ca1\u5b8c"),Object(o.b)("h2",{id:"conclusion"},"Conclusion"),Object(o.b)("p",null,"\u5728\u4f7f\u7528typescript\u76f8\u5173API\u65f6\u9700\u8981\u5148\u52a0\u8f7d\u5bf9\u5e94\u7684\u7c7b\u578b\u5b9a\u4e49\u6587\u4ef6\u554a\uff01\uff01\uff01"))}s&&s===Object(s)&&Object.isExtensible(s)&&Object.defineProperty(s,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MDXContent",filename:"src/typescript/an experience with react-docgen-typescript.mdx"}}),s.isMDXComponent=!0}}]);
//# sourceMappingURL=src-typescript-an-experience-with-react-docgen-typescript.e6b92a49b375a5074cff.js.map