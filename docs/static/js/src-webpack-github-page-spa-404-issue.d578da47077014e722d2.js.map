{"version":3,"sources":["/Users/liliuyun/git/frontend-stories/src/webpack/github page SPA 404 issue.mdx"],"names":["layoutProps","MDXLayout","MDXContent","_ref","components","props","Object","_Users_liliuyun_git_frontend_stories_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","_mdx_js_react__WEBPACK_IMPORTED_MODULE_2__","assign","mdxType","id","parentName","href","isMDXComponent"],"mappings":"qZAWMA,EAAc,GAGdC,EAAY,UACH,SAASC,EAATC,GAGZ,IAFDC,EAECD,EAFDC,WACGC,EACFC,OAAAC,EAAA,EAAAD,CAAAH,EAAA,gBACD,OAAOG,OAAAE,EAAA,EAAAF,CAACL,EAADK,OAAAG,OAAA,GAAeT,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYM,QAAQ,cAC5EJ,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,qDADR,qDAGAL,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,cADR,cAGAL,OAAAE,EAAA,EAAAF,CAAA,+KACSA,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MADxB,yCAEeN,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MAF9B,uSAGqEN,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MAHpF,wJAKAN,OAAAE,EAAA,EAAAF,CAAA,6+BAGAA,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,YADR,YAGAL,OAAAE,EAAA,EAAAF,CAAA,sEACAA,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,YADR,YAGAL,OAAAE,EAAA,EAAAF,CAAA,suBACAA,OAAAE,EAAA,EAAAF,CAAA,4FACAA,OAAAE,EAAA,EAAAF,CAAA,WAAKA,OAAAE,EAAA,EAAAF,CAAA,OAAAA,OAAAG,OAAA,CAAMG,WAAW,OAAU,IAA3B,0IAKLN,OAAAE,EAAA,EAAAF,CAAA,4IAAwCA,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MAAvD,6EAEAN,OAAAE,EAAA,EAAAF,CAAA,WAAKA,OAAAE,EAAA,EAAAF,CAAA,OAAAA,OAAAG,OAAA,CAAMG,WAAW,OAAU,IAA3B,kPAULN,OAAAE,EAAA,EAAAF,CAAA,sQACAA,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,YADR,YAGAL,OAAAE,EAAA,EAAAF,CAAA,6aAA8FA,OAAAE,EAAA,EAAAF,CAAA,IAAAA,OAAAG,OAAA,CAAGG,WAAW,KAAQ,CAChHC,KAAQ,gEADkF,uBAA9F,sHAGAP,OAAAE,EAAA,EAAAF,CAAA,kBACEA,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,cACbN,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MAAf,uDACAN,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MAAf,6CACAN,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MAAf,oDAGJN,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,sBADR,uBAGAL,OAAAE,EAAA,EAAAF,CAAA,wZACAA,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,aADR,aAGAL,OAAAE,EAAA,EAAAF,CAAA,SAAGA,OAAAE,EAAA,EAAAF,CAAA,IAAAA,OAAAG,OAAA,CAAGG,WAAW,KAAQ,CACrBC,KAAQ,+CADT,8CAEoDP,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MAFtE,KAGFN,OAAAE,EAAA,EAAAF,CAAA,IAAAA,OAAAG,OAAA,CAAGG,WAAW,KAAQ,CAChBC,KAAQ,8FADd,6FAEwGP,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MALrH,KAMFN,OAAAE,EAAA,EAAAF,CAAA,IAAAA,OAAAG,OAAA,CAAGG,WAAW,KAAQ,CAChBC,KAAQ,iEADd,gEAE2EP,OAAAE,EAAA,EAAAF,CAAA,MAAIM,WAAW,MARxF,KASFN,OAAAE,EAAA,EAAAF,CAAA,IAAAA,OAAAG,OAAA,CAAGG,WAAW,KAAQ,CAChBC,KAAQ,gEADd,+DATE,sMAeJX,EAAWY,gBAAiB","file":"static/js/src-webpack-github-page-spa-404-issue.d3191da6.js","sourcesContent":["/* @jsx mdx */\n  import React from 'react'\n  import { mdx } from '@mdx-js/react'\n  /* @jsx mdx */\n\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h1 {...{\n      \"id\": \"github-pages-单页应用问题\"\n    }}>{`github pages 单页应用问题`}</h1>\n    <h2 {...{\n      \"id\": \"background\"\n    }}>{`Background`}</h2>\n    <p>{`最近想用docz来管理markdowns并在github.io上部署，\n基本步骤没有任何问题:`}<br parentName=\"p\"></br>{`\n`}{`1. 新建github仓库`}<br parentName=\"p\"></br>{`\n`}{`2. 往master分支推送静态资源，如html，js，css，如果不希望直接使用根目录来部署，则新建/docs目录并移入这些静态资源`}<br parentName=\"p\"></br>{`\n`}{`3. 在github仓库的setting页中设置使用master分支的/docs目录展示github pages  `}</p>\n    <p>{`部署完成后，页面显示了，点击跳转也没有出现任何问题。然而，天有不测风云，刷新页面就404了。\n原理很简单，github pages对于我们部署的资源来说相当于一个文件服务器，\n假设我们访问的路径是/repo/dir，由于我们的html文件只输出在了/repo/index.html，在寻找/repo/dir/index.html的时候Not Found了。通常我们在输出SPA的时候会使用get('*', callback)来将所有的路径映射到同样的静态资源文件，然而在github pages不能做这种操作。`}</p>\n    <h2 {...{\n      \"id\": \"solution\"\n    }}>{`Solution`}</h2>\n    <p>{`能考虑一些方案如下:  `}</p>\n    <h3 {...{\n      \"id\": \"redirect\"\n    }}>{`redirect`}</h3>\n    <p>{`采用404.html重定向的方案。这种方案可能有多种实现方式，但是核心思想是一致的。在404页面记录当前的url（例如采用H5 storage方案），跳转到根目录（另一种可行的方案是用search params的方式来记录）。根目录的index.html页面获取记录的url并采用history API进行跳转。在这种思路下给出的一种实现方式：  `}</p>\n    <p>{`自定义404.html,要求head包含如下内容`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`<script>\n  sessionStorage.redirect = location.href;\n</script>\n<meta http-equiv=\"refresh\" content=\"0;URL='/REPO_NAME'\"></meta>\n`}</code></pre>\n    <p>{`表示在进入页面后的0秒时进行刷新，新的url是/REPO_NAME`}<br parentName=\"p\"></br>{`\n`}{`在index.html的head中包含如下内容`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`<script>\n  (function(){\n    var redirect = sessionStorage.redirect;\n    delete sessionStorage.redirect;\n    if (redirect && redirect != location.href) {\n      history.replaceState(null, null, redirect);\n    }\n  })();\n</script>\n`}</code></pre>\n    <p>{`这是一个立即执行函数，获取刚才在404页面保存的url并使用history API 进行跳转（现在的SPA常用的方法）`}</p>\n    <h3 {...{\n      \"id\": \"snapshot\"\n    }}>{`snapshot`}</h3>\n    <p>{`使用快照技术生成页面的方案。由于github pages中我们没办法使用SSR来进行SEO，但是使用快照技术也可以支持SEO，缺点是需要引入其他的外部扩展。这里提供一种方案是`}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/esalter-va/webpack-static-site-generator\"\n      }}>{`StaticSiteGenerator`}</a>{`。该plugin的作者也阐述了该方案的基本原理：`}</p>\n    <blockquote>\n      <ol parentName=\"blockquote\">\n        <li parentName=\"ol\">{`Serves the specified output directory using express`}</li>\n        <li parentName=\"ol\">{`Loads each provided route using Nightmare`}</li>\n        <li parentName=\"ol\">{`Saves the HTML of each route to the filesystem`}</li>\n      </ol>\n    </blockquote>\n    <h3 {...{\n      \"id\": \"multiple-indexhtml\"\n    }}>{`multiple index.html`}</h3>\n    <p>{`另外一种方案就是把所有可能的路由用CopyWebpackPlugin的方式将index.html文件复制到各个位置了。个人觉得如果都是SPA不考虑SEO的话，redirect方案会比这个方案舒服一点。`}</p>\n    <h2 {...{\n      \"id\": \"reference\"\n    }}>{`Reference`}</h2>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://github.com/rafrex/spa-github-pages\"\n      }}>{`https://github.com/rafrex/spa-github-pages`}</a><br parentName=\"p\"></br>{`\n`}<a parentName=\"p\" {...{\n        \"href\": \"http://www.backalleycoder.com/2016/05/13/sghpa-the-single-page-app-hack-for-github-pages/\"\n      }}>{`http://www.backalleycoder.com/2016/05/13/sghpa-the-single-page-app-hack-for-github-pages/`}</a><br parentName=\"p\"></br>{`\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://dev.to/_evansalter/github-pages-and-single-page-apps\"\n      }}>{`https://dev.to/_evansalter/github-pages-and-single-page-apps`}</a><br parentName=\"p\"></br>{`\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/esalter-va/webpack-static-site-generator\"\n      }}>{`https://github.com/esalter-va/webpack-static-site-generator`}</a>{`  `}</p>\n    </MDXLayout>;\n}\n\nMDXContent.isMDXComponent = true;\n  "],"sourceRoot":""}